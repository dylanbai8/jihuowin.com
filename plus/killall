# 检查当前是否以管理员权限运行
$isAdmin = [Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()
$adminRole = [Security.Principal.WindowsBuiltInRole]::Administrator

if ($isAdmin.IsInRole($adminRole)) {

    # 获取所有非系统进程并终止它们
    $processes = Get-Process | Where-Object { $_.Path -and $_.Path -notmatch 'C:\\Windows\\' }

    foreach ($process in $processes) {
        try {
            Write-Host "Killing process: $($process.Name) with PID: $($process.Id)"
            Stop-Process -Id $process.Id -Force
        }
        catch {
            Write-Host "Failed to kill process: $($process.Name) with PID: $($process.Id)"
        }
    }
} else {
    Write-Warning "Please run Powershell as administrator."
}

